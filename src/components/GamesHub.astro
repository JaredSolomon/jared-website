---
interface Game {
  id: string;
  name: string;
  url: string;
}

const DAILY_GAMES: Game[] = [
  {
    id: "wordle",
    name: "Wordle",
    url: "https://www.nytimes.com/games/wordle/index.html",
  },
  {
    id: "connections",
    name: "Connections",
    url: "https://www.nytimes.com/games/connections",
  },
  {
    id: "strands",
    name: "Strands",
    url: "https://www.nytimes.com/games/strands",
  },
  {
    id: "nytmini",
    name: "NYT Daily Mini",
    url: "https://www.nytimes.com/crosswords/game/mini",
  },
  { id: "disorderly", name: "Disorderly", url: "https://playdisorderly.com/" },
  { id: "timeguessr", name: "TimeGuessr", url: "https://timeguessr.com" },
  { id: "bandle", name: "Bandle", url: "https://bandle.app" },
  {
    id: "movietomovie",
    name: "Movie to Movie",
    url: "https://movietomovie.com/",
  },
  { id: "framed", name: "Framed", url: "https://framed.wtf" },
  {
    id: "cine2nerdle",
    name: "Cine2Nerdle",
    url: "https://www.cinenerdle2.app",
  },
  {
    id: "hardgolf",
    name: "Kinda Hard Golf",
    url: "https://kindahardgolf.com/",
  },
  {
    id: "dozen",
    name: "The Dozen: Daily Trivia",
    url: "https://dailydozentrivia.com/",
  },
  { id: "costcodle", name: "CostCodle", url: "https://costcodle.com/" },
  { id: "raddle", name: "Raddle", url: "https://raddle.quest" },
  { id: "scrandle", name: "Scrandle", url: "https://scrandle.com/" },
  { id: "foodguessr", name: "FoodGuessr", url: "https://www.foodguessr.com/" },
  {
    id: "pinpoint",
    name: "Pinpoint",
    url: "https://www.linkedin.com/games/pinpoint",
  },
  {
    id: "crossclimb",
    name: "Crossclimb",
    url: "https://www.linkedin.com/games/crossclimb",
  },
  {
    id: "queens",
    name: "Queens",
    url: "https://www.linkedin.com/games/queens",
  },
  {
    id: "zip",
    name: "Zip",
    url: "https://www.linkedin.com/games/zip",
  },
  {
    id: "tango",
    name: "Tango",
    url: "https://www.linkedin.com/games/tango",
  },
  {
    id: "minisudoku",
    name: "Mini Sudoku",
    url: "https://www.linkedin.com/games/minisudoku",
  },
];

const WEEKLY_GAMES: Game[] = [
  {
    id: "fanduel",
    name: "FanDuel League",
    url: "https://www.fanduel.com/leagues/1582526",
  },
  {
    id: "survivor",
    name: "Fantasy Survivor",
    url: "https://www.fantasysurvivorgame.com/vote.html",
  },
];
---

<div class="w-full max-w-6xl mx-auto flex flex-col gap-12 p-4 md:p-8">
  <a
    href="/"
    class="inline-flex items-center gap-2 text-gray-400 hover:text-white transition-colors group w-fit"
  >
    <span class="group-hover:-translate-x-1 transition-transform duration-300"
      >‚Üê</span
    > Return to Home
  </a>
  <!-- Daily Games Section -->
  <div class="relative group" id="daily-section">
    <div
      class="absolute -inset-0.5 bg-gradient-to-r from-primary/20 to-purple-500/20 rounded-[32px] blur opacity-50 group-hover:opacity-75 transition duration-1000"
    >
    </div>
    <div
      class="relative bg-surface backdrop-blur-xl border border-white/10 rounded-[30px] p-6 md:p-10 overflow-hidden"
    >
      <!-- Header -->
      <header
        class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-10"
      >
        <div>
          <h2
            class="text-3xl md:text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-white to-white/50 tracking-tight mb-2"
          >
            Daily Games
          </h2>
          <div class="flex items-center gap-3">
            <span
              class="px-3 py-1 rounded-full bg-white/5 border border-white/10 text-sm text-gray-400 font-medium"
              id="daily-date">Today</span
            >
            <span class="text-sm text-gray-500" id="daily-progress-text"
              >0 / 0</span
            >
          </div>
        </div>

        <div class="flex-1 max-w-md w-full">
          <div class="h-2 bg-white/5 rounded-full overflow-hidden">
            <div
              class="h-full bg-primary shadow-[0_0_12px_rgba(16,185,129,0.5)] transition-all duration-500 ease-out rounded-full"
              id="daily-progress-fill"
              style="width: 0%"
            >
            </div>
          </div>
        </div>
      </header>

      <!-- Grid -->
      <div
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-10"
      >
        {
          DAILY_GAMES.map((game) => (
            <div
              class="group/card relative"
              data-id={game.id}
              data-period="daily"
            >
              <div class="absolute inset-0 bg-gradient-to-r from-white/5 to-white/0 rounded-2xl opacity-0 group-hover/card:opacity-100 transition-opacity duration-300" />
              <div class="relative flex items-center justify-between p-4 bg-surface-hover border border-white/5 rounded-2xl hover:border-white/20 hover:bg-white/5 transition-all duration-300 hover:-translate-y-1 group-[.is-done]/card:opacity-50 group-[.is-done]/card:hover:opacity-75">
                <a
                  href={game.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="flex items-center gap-4 flex-1 min-w-0 group-hover/card:translate-x-1 transition-transform duration-300"
                >
                  <div class="w-10 h-10 rounded-xl bg-black/40 flex items-center justify-center overflow-hidden shadow-inner ring-1 ring-white/10">
                    <img
                      src={`https://www.google.com/s2/favicons?domain=${new URL(game.url).hostname}&sz=64`}
                      alt=""
                      class="w-full h-full object-cover opacity-80 group-hover/card:opacity-100 transition-opacity"
                      loading="lazy"
                    />
                  </div>
                  <span class="font-medium text-gray-200 truncate group-[.is-done]/card:line-through group-[.is-done]/card:text-gray-500">
                    {game.name}
                  </span>
                </a>

                <button
                  class="check-btn relative z-10 p-2 text-gray-500 hover:text-white transition-colors"
                  aria-label={`Mark ${game.name} as done`}
                >
                  <div class="w-6 h-6 rounded-full border-2 border-current flex items-center justify-center group-[.is-done]/card:border-primary group-[.is-done]/card:bg-primary group-[.is-done]/card:text-black transition-all duration-300">
                    <svg
                      class="w-3.5 h-3.5 opacity-0 group-[.is-done]/card:opacity-100 transform scale-50 group-[.is-done]/card:scale-100 transition-all duration-300"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="4"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <polyline points="20 6 9 17 4 12" />
                    </svg>
                  </div>
                </button>
              </div>
            </div>
          ))
        }
      </div>

      <!-- Controls -->
      <div class="flex justify-end gap-4 border-t border-white/5 pt-6">
        <button
          class="px-4 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all"
          id="daily-reset">Reset Day</button
        >
        <button
          class="px-4 py-2 rounded-lg text-sm font-medium bg-primary text-black hover:bg-emerald-400 hover:shadow-[0_0_20px_rgba(16,185,129,0.3)] transition-all"
          id="daily-mark-all">Mark All Done</button
        >
      </div>
    </div>
  </div>

  <!-- Weekly Games Section -->
  <div class="relative group" id="weekly-section">
    <div
      class="absolute -inset-0.5 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-[32px] blur opacity-50 group-hover:opacity-75 transition duration-1000"
    >
    </div>
    <div
      class="relative bg-surface backdrop-blur-xl border border-white/10 rounded-[30px] p-6 md:p-10 overflow-hidden"
    >
      <header
        class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-10"
      >
        <div>
          <h2
            class="text-3xl md:text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-white to-white/50 tracking-tight mb-2"
          >
            Weekly Games
          </h2>
          <div class="flex items-center gap-3">
            <span
              class="px-3 py-1 rounded-full bg-white/5 border border-white/10 text-sm text-gray-400 font-medium"
              id="weekly-date">This Week</span
            >
            <span class="text-sm text-gray-500" id="weekly-progress-text"
              >0 / 0</span
            >
          </div>
        </div>

        <div class="flex-1 max-w-md w-full">
          <div class="h-2 bg-white/5 rounded-full overflow-hidden">
            <div
              class="h-full bg-primary shadow-[0_0_12px_rgba(16,185,129,0.5)] transition-all duration-500 ease-out rounded-full"
              id="weekly-progress-fill"
              style="width: 0%"
            >
            </div>
          </div>
        </div>
      </header>

      <div
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-10"
      >
        {
          WEEKLY_GAMES.map((game) => (
            <div
              class="group/card relative"
              data-id={game.id}
              data-period="weekly"
            >
              <div class="absolute inset-0 bg-gradient-to-r from-white/5 to-white/0 rounded-2xl opacity-0 group-hover/card:opacity-100 transition-opacity duration-300" />
              <div class="relative flex items-center justify-between p-4 bg-surface-hover border border-white/5 rounded-2xl hover:border-white/20 hover:bg-white/5 transition-all duration-300 hover:-translate-y-1 group-[.is-done]/card:opacity-50 group-[.is-done]/card:hover:opacity-75">
                <a
                  href={game.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="flex items-center gap-4 flex-1 min-w-0 group-hover/card:translate-x-1 transition-transform duration-300"
                >
                  <div class="w-10 h-10 rounded-xl bg-black/40 flex items-center justify-center overflow-hidden shadow-inner ring-1 ring-white/10">
                    <img
                      src={`https://www.google.com/s2/favicons?domain=${new URL(game.url).hostname}&sz=64`}
                      alt=""
                      class="w-full h-full object-cover opacity-80 group-hover/card:opacity-100 transition-opacity"
                      loading="lazy"
                    />
                  </div>
                  <span class="font-medium text-gray-200 truncate group-[.is-done]/card:line-through group-[.is-done]/card:text-gray-500">
                    {game.name}
                  </span>
                </a>

                <button
                  class="check-btn relative z-10 p-2 text-gray-500 hover:text-white transition-colors"
                  aria-label={`Mark ${game.name} as done`}
                >
                  <div class="w-6 h-6 rounded-full border-2 border-current flex items-center justify-center group-[.is-done]/card:border-primary group-[.is-done]/card:bg-primary group-[.is-done]/card:text-black transition-all duration-300">
                    <svg
                      class="w-3.5 h-3.5 opacity-0 group-[.is-done]/card:opacity-100 transform scale-50 group-[.is-done]/card:scale-100 transition-all duration-300"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="4"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <polyline points="20 6 9 17 4 12" />
                    </svg>
                  </div>
                </button>
              </div>
            </div>
          ))
        }
      </div>

      <div class="flex justify-end gap-4 border-t border-white/5 pt-6">
        <button
          class="px-4 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all"
          id="weekly-reset">Reset Week</button
        >
        <button
          class="px-4 py-2 rounded-lg text-sm font-medium bg-primary text-black hover:bg-emerald-400 hover:shadow-[0_0_20px_rgba(16,185,129,0.3)] transition-all"
          id="weekly-mark-all">Mark All Done</button
        >
      </div>
    </div>
  </div>
</div>

<script>
  // Client-side logic
  const DAILY_GAMES_IDS = [
    "wordle",
    "connections",
    "strands",
    "nytmini",
    "disorderly",
    "timeguessr",
    "bandle",
    "movietomovie",
    "framed",
    "cine2nerdle",
    "hardgolf",
    "dozen",
    "costcodle",
    "raddle",
    "scrandle",
    "foodguessr",
    "pinpoint",
    "crossclimb",
    "queens",
    "zip",
    "tango",
    "minisudoku",
  ];
  const WEEKLY_GAMES_IDS = ["fanduel", "survivor"];

  const todayISO = () => {
    const n = new Date();
    return new Date(n.getFullYear(), n.getMonth(), n.getDate())
      .toISOString()
      .slice(0, 10);
  };

  const startOfWeekISO = () => {
    const n = new Date();
    const d = new Date(n.getFullYear(), n.getMonth(), n.getDate());
    const day = d.getDay();
    const toMon = (day + 6) % 7;
    d.setDate(d.getDate() - toMon);
    return d.toISOString().slice(0, 10);
  };

  function initSection(period, gameIds) {
    const storageKey = `${period}Games:state`;
    const periodKey = period === "daily" ? todayISO() : startOfWeekISO();

    // Update date display
    const dateEl = document.getElementById(`${period}-date`);
    if (dateEl) dateEl.textContent = periodKey;

    // Load state
    let state = { periodKey, done: {} };
    try {
      const raw = localStorage.getItem(storageKey);
      if (raw) {
        const parsed = JSON.parse(raw);
        if (parsed.periodKey === periodKey) {
          state = parsed;
        }
      }
    } catch (e) {
      console.warn("State load error", e);
    }

    const save = () => localStorage.setItem(storageKey, JSON.stringify(state));

    const updateUI = () => {
      const total = gameIds.length;
      const doneCount = Object.keys(state.done).length;
      const pct = total ? Math.round((doneCount / total) * 100) : 0;

      const fill = document.getElementById(`${period}-progress-fill`);
      const text = document.getElementById(`${period}-progress-text`);

      if (fill) fill.style.width = `${pct}%`;
      if (text) text.textContent = `${doneCount} / ${total}`;

      // Update cards
      document
        .querySelectorAll(`.group\\/card[data-period="${period}"]`)
        .forEach((card) => {
          const id = card.getAttribute("data-id");
          if (state.done[id]) {
            card.classList.add("is-done");
          } else {
            card.classList.remove("is-done");
          }
        });
    };

    // Event Listeners
    document
      .querySelectorAll(`.group\\/card[data-period="${period}"]`)
      .forEach((card) => {
        const id = card.getAttribute("data-id");
        const link = card.querySelector("a");
        const btn = card.querySelector(".check-btn");

        // Link click marks as done
        link?.addEventListener("click", () => {
          state.done[id] = true;
          save();
          updateUI();
        });

        // Toggle button
        btn?.addEventListener("click", () => {
          if (state.done[id]) {
            delete state.done[id];
          } else {
            state.done[id] = true;
          }
          save();
          updateUI();
        });
      });

    // Controls
    document
      .getElementById(`${period}-mark-all`)
      ?.addEventListener("click", () => {
        gameIds.forEach((id) => (state.done[id] = true));
        save();
        updateUI();
      });

    document
      .getElementById(`${period}-reset`)
      ?.addEventListener("click", () => {
        state.done = {};
        save();
        updateUI();
      });

    // Initial render
    updateUI();
  }

  // Initialize
  initSection("daily", DAILY_GAMES_IDS);
  initSection("weekly", WEEKLY_GAMES_IDS);
</script>
